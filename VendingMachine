#include <stdio.h>


// Constants for the Vending Machine prices and minimum quantity alert
int Min=5;
float itemPriceA = 1.5;
float itemPriceB=2.0;
float itemPriceC=2.5;

// Passwords for the admin and also the quantity for the items
int password= 1234;
float total_amount=0;
int quantityA= 10;
int quantityB= 10;
int quantityC= 10;


// Function Prototypes for the Vending Machine
void itemPurchase();
void adminMode ();

int main() {
    int choice;

    while(1) {
        printf("Welcome to the Vending Machine\t\n");
        printf("1) Purchase the item for the consumer\t\n");
        printf("2) Admin mode for the vending machine\t\n");
        printf("3) Exit\t\n");
        printf("Enter your choice number: ");
        scanf("%i",&choice);

        switch(choice) {
            case 1:
                 itemPurchase();
                 break;
            case 2:
                adminMode();
                break;
            case 3:
                 printf("Exiting the program. Thank you.\n");
                 return 0;
            default:
                printf("Choice invalid. Please try again.\n");            
        }
    }
}


void itemPurchase(){
    printf("Items Available:\n");
    printf("1) Item A ~ Price: %.2f\n", itemPriceA);
    printf("2) Item b ~ Price: %.2f\n", itemPriceB);
    printf("3) Item c ~ Price: %.2f\n", itemPriceC);
    printf("0) Cancel the operation\n");

    int choiceItem;
    float dirhams;

    while (1) {
        printf("Enter your selection: \n ");
        scanf("%i", &choiceItem);

        if(choiceItem == 0) {
            printf("Purchase canceled.\n");
            return;
        }

        float itemPrice;
        int *quantity;

        switch (choiceItem) {
            case 1:
                itemPrice = itemPriceA;
                quantity = &quantityA;
                break;
            case 2:
                itemPrice = itemPriceB;
                quantity = &quantityB;
                break;
            case 3:
                itemPrice = itemPriceC;
                quantity = &quantityC;
                break;
            default:
                printf("Invalid item choice. Please try again.\t\n");
                continue;    
        }
     
    printf("You selected item %c with a price of %.2f. Confirm? (Y/N): \n",'A' + choiceItem - 1, itemPrice);
char confirmation;
scanf(" %c", &confirmation);

if (confirmation != 'Y' && confirmation != 'y') {
    printf("Purchase canceled.\n");
    return;
}


float paidAmount = 0;
while (paidAmount < itemPrice) {
    printf("Please insert a dirhams (0.25, 0.50, 1.00): ");
    scanf("%f", &dirhams);

    if (dirhams != 0.25 && dirhams != 0.50 && dirhams != 1.00) {
        printf("Invalid dirhams. Try again or cancel the purchase.\n");
        char cancel;
        printf("Cancel the purchase? (Y/N): \n");
        scanf("%c", &cancel);

        if (cancel == 'Y' || cancel == 'y') {
            printf("Purchase canceled. \n");
            return;
        }

    } else {
        paidAmount += dirhams;
    }
}

    
*quantity -= 1;
total_amount += itemPrice;

printf("You have purchased item %c for %.2f. Paid: %.2f. Change: %.2f\n", 'A' + choiceItem - 1, itemPrice, paidAmount, paidAmount - itemPrice);

if (*quantity <= Min) {
    printf("Alert: The quantity of the item %c is low! \n", 'A' + choiceItem - 1);
}
return;

}
}

void adminMode() {
    int adminPassword;
    printf("\nPlease enter the admin password: ");
    scanf("%i", &adminPassword);

    if (adminPassword != password) {
        printf("Incorrect password. Exiting admin mode.\n");
        return;
    }
    
    int choice;

    while (1) {
        printf("\n Admin mode: \n");
        printf("1) Replenish Items \n");
        printf("2) Change Item Prices \n");
        printf("3) Display Total Sale \n");
        printf("4) Display Item Availability \n");
        printf("0) Exit Admin Mode \n");
        printf(" Enter your choice: ");
        scanf("%i", &choice);


        switch (choice)
        {
        case 1:
            quantityA = rand() % 20 + 1;
            quantityB = rand() % 20 + 1;
            quantityC = rand() % 20 + 1;
            printf("Items replenished.\n");
            break;
        case 2:
            printf("Enter a new price for item A: ");
            scanf("%f", &itemPriceA);
            printf("Enter a new price for item B: ");
            scanf("%f", &itemPriceB);
            printf("Enter a new price for item C: ");
            scanf("%f", &itemPriceC);
            printf("Prices are updated.\n");
            break;
        case 3:
            printf("Total sale amount : .%2f\n", total_amount);
            char choiceReset;
            printf(" Reset total salle amount? (Y/N): ");
            scanf("%c", &choiceReset);
            
            if (choiceReset == 'Y' || choiceReset == 'y') {
                total_amount = 0;
                printf("The total sale amount reset to zero. Collect the money from the machine.\n");
            }
            break;
        case 4:
             printf("Item A: Quantity %i\n", quantityA);
             printf("Item B: Quantity %i\n", quantityB);
             printf("Item C: Quantity %i\n", quantityC);
             break;
        case 5:
            printf("Exiting the admin mode. \n");
            return;     
    
        default:
            printf("Invalid Choice. Please try again.\n");
            

        }
    }
}